<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your Perfect Plan - Sydney Mobile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-50 min-h-screen font-sans">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="text-xl font-bold text-blue-600">SydneyMobile</div>
                <button onclick="window.history.back()"
                    class="bg-blue-50 text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-100 transition-colors">
                    Back to Home
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto py-8 px-4">
        <div class="max-w-3xl mx-auto">
            <!-- Progress Steps -->
            <div class="mb-8">
                <div class="flex justify-between items-center">
                    <div class="flex-1">
                        <div class="flex items-center">
                            <div class="step-circle active">1</div>
                            <div class="flex-1 h-1 bg-gray-200 mx-2">
                                <div class="progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <p class="text-sm mt-2 text-center">About You</p>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center">
                            <div class="step-circle">2</div>
                            <div class="flex-1 h-1 bg-gray-200 mx-2">
                                <div class="progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <p class="text-sm mt-2 text-center">Usage Needs</p>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center">
                            <div class="step-circle">3</div>
                            <div class="flex-1 h-1 bg-gray-200 mx-2">
                                <div class="progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <p class="text-sm mt-2 text-center">Features</p>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center">
                            <div class="step-circle">4</div>
                        </div>
                        <p class="text-sm mt-2 text-center">Results</p>
                    </div>
                </div>
            </div>

            <!-- Form Container -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <!-- Step 1: About You -->
                <div class="step-content" id="step1">
                    <h2 class="text-2xl font-bold mb-6">What brings you to Sydney?</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">
                        <button
                            class="user-type-btn p-4 border-2 border-gray-200 rounded-lg text-left hover:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            data-type="tourist">
                            <h3 class="font-semibold mb-1">Tourist</h3>
                            <p class="text-sm text-gray-600">Visiting Sydney for a short time</p>
                        </button>
                        <button
                            class="user-type-btn p-4 border-2 border-gray-200 rounded-lg text-left hover:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            data-type="student">
                            <h3 class="font-semibold mb-1">Student</h3>
                            <p class="text-sm text-gray-600">Studying in Sydney</p>
                        </button>
                        <button
                            class="user-type-btn p-4 border-2 border-gray-200 rounded-lg text-left hover:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            data-type="business">
                            <h3 class="font-semibold mb-1">Business</h3>
                            <p class="text-sm text-gray-600">Here for work</p>
                        </button>
                        <button
                            class="user-type-btn p-4 border-2 border-gray-200 rounded-lg text-left hover:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            data-type="resident">
                            <h3 class="font-semibold mb-1">Resident</h3>
                            <p class="text-sm text-gray-600">Living in Sydney</p>
                        </button>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-medium text-gray-700 mb-2">How long are you staying?</label>
                        <select id="stayDuration"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select duration</option>
                            <option value="short">Less than 1 month</option>
                            <option value="medium">1-3 months</option>
                            <option value="long">3+ months</option>
                            <option value="permanent">Permanent</option>
                        </select>
                    </div>

                    <button id="nextStep1"
                        class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-300"
                        disabled>
                        Next: Usage Needs
                    </button>
                </div>

                <!-- Step 2: Usage Needs -->
                <div class="step-content hidden" id="step2">
                    <h2 class="text-2xl font-bold mb-6">Tell us about your usage needs</h2>

                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Monthly Budget (AUD)</label>
                        <input type="number" id="budget"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Enter amount">
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Plan Type Preference</label>
                        <div class="space-y-2">
                            <label
                                class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="planType" value="any" class="h-4 w-4 text-blue-600">
                                <span class="ml-2">No preference</span>
                            </label>
                            <label
                                class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="planType" value="prepaid" class="h-4 w-4 text-blue-600">
                                <span class="ml-2">Prepaid</span>
                            </label>
                            <label
                                class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="planType" value="postpaid" class="h-4 w-4 text-blue-600">
                                <span class="ml-2">Postpaid</span>
                            </label>
                        </div>
                    </div>

                    <!-- Usage Calculator Integration -->
                    <div class="mb-8 bg-white rounded-xl shadow-sm border border-gray-100">
                        <div class="p-6">
                            <h3 class="text-lg font-semibold mb-4 text-gray-900">Calculate Your Data Needs</h3>

                            <!-- Trip Duration -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Trip Duration (days)
                                </label>
                                <input type="number" id="tripDuration" min="1" max="365"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    value="7">
                            </div>

                            <!-- Daily Activities -->
                            <div class="space-y-4">
                                <!-- Maps/Navigation -->
                                <div class="flex items-center space-x-4">
                                    <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <label class="block text-sm font-medium text-gray-700">Maps & Navigation</label>
                                        <input type="number" id="navigationHours" min="0" max="24"
                                            class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Hours per day">
                                    </div>
                                </div>

                                <!-- Video Calls -->
                                <div class="flex items-center space-x-4">
                                    <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <label class="block text-sm font-medium text-gray-700">Video Calls</label>
                                        <input type="number" id="videoHours" min="0" max="24"
                                            class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Hours per day">
                                    </div>
                                </div>

                                <!-- Social Media -->
                                <div class="flex items-center space-x-4">
                                    <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center">
                                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <label class="block text-sm font-medium text-gray-700">Social Media</label>
                                        <input type="number" id="socialHours" min="0" max="24"
                                            class="mt-1 w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            placeholder="Hours per day">
                                    </div>
                                </div>
                            </div>

                            <!-- Results Section -->
                            <div class="mt-6 bg-blue-50 rounded-xl p-4">
                                <h4 class="font-medium text-blue-900">Estimated Monthly Data Usage</h4>
                                <div id="usageResult" class="mt-2">
                                    <p class="text-blue-800 text-2xl font-bold">-- GB</p>
                                </div>
                                <input type="hidden" id="dataNeeds" value="">
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="prevStep()"
                            class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-200 transition-colors">
                            Back
                        </button>
                        <button id="nextStep2"
                            class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-300"
                            disabled>
                            Next: Features
                        </button>
                    </div>
                </div>

                <!-- Step 3: Features -->
                <div class="step-content hidden" id="step3">
                    <h2 class="text-2xl font-bold mb-6">Additional Features</h2>

                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Where will you mainly use your
                            phone?</label>
                        <select id="location"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select your main area</option>
                            <option value="cbd">City Centre (CBD) - Downtown Sydney, Opera House, Harbour Bridge area
                            </option>
                            <option value="inner">Inner City - Surry Hills, Newtown, Glebe, trendy neighborhoods
                            </option>
                            <option value="eastern">Eastern Beaches - Bondi, Coogee, Bronte Beach areas</option>
                            <option value="western">Greater West - Parramatta, Olympic Park, Western suburbs</option>
                            <option value="northern">North Shore - Manly, Chatswood, Northern beaches</option>
                            <option value="southern">South Sydney - Airport area, Cronulla Beach, The Shire</option>
                        </select>

                        <!-- Area Description (initially hidden) -->
                        <div id="areaDescription" class="hidden mt-3 p-4 bg-blue-50 rounded-lg">
                            <div class="flex items-start space-x-3">
                                <div class="w-5 h-5 mt-0.5">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                <div>
                                    <p id="areaDetail" class="text-sm text-gray-700"></p>
                                    <p id="areaTouristSpots" class="text-sm text-blue-600 mt-2"></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <label class="block text-sm font-medium text-gray-700 mb-4">Select the features you
                            need:</label>
                        <div class="space-y-3">
                            <label
                                class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" name="features" value="coverage" class="h-4 w-4 text-blue-600">
                                <span class="ml-2">Premium Coverage</span>
                            </label>
                            <label
                                class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" name="features" value="international"
                                    class="h-4 w-4 text-blue-600">
                                <span class="ml-2">International Calls/Roaming</span>
                            </label>
                            <label
                                class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" name="features" value="entertainment"
                                    class="h-4 w-4 text-blue-600">
                                <span class="ml-2">Entertainment Packages</span>
                            </label>
                            <label
                                class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="checkbox" name="features" value="speed" class="h-4 w-4 text-blue-600">
                                <span class="ml-2">5G Speed</span>
                            </label>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button onclick="prevStep()"
                            class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-200 transition-colors">
                            Back
                        </button>
                        <button id="nextStep3"
                            class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-300"
                            disabled>
                            Show Recommendations
                        </button>
                    </div>
                </div>

                <!-- Step 4: Results -->
                <div class="step-content hidden" id="step4">
                    <h2 class="text-2xl font-bold mb-6">Your Recommended Plans</h2>

                    <!-- Results Container -->
                    <div class="space-y-8" id="recommendationsList">
                        <!-- Loading State -->
                        <div class="text-center py-8" id="loadingState">
                            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
                            <p class="mt-4 text-gray-600">Finding the best plans for you...</p>
                        </div>
                    </div>
                </div>

                <!-- Template for recommendation card -->
                <template id="recommendationTemplate">
                    <div class="bg-white rounded-xl border-2 border-blue-500 p-6 shadow-lg">
                        <!-- Provider Header -->
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-semibold"></h3>
                                <p class="text-gray-600"></p>
                                <p class="text-sm text-gray-500">Network: <span class="network-name"></span></p>
                            </div>
                            <span
                                class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full recommendation-tag"></span>
                        </div>

                        <!-- Quick Stats -->
                        <div class="grid grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
                            <div class="text-center">
                                <div class="text-sm text-gray-500">Coverage</div>
                                <div class="font-semibold coverage-quality"></div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-500">Starting From</div>
                                <div class="font-semibold price"></div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm text-gray-500">Data</div>
                                <div class="font-semibold data-amount"></div>
                            </div>
                        </div>

                        <!-- Expandable Sections -->
                        <div class="space-y-4">
                            <!-- Nearby Stores -->
                            <div class="border rounded-lg">
                                <button class="flex justify-between items-center w-full px-4 py-3 text-left">
                                    <span class="font-medium">Nearby Stores</span>
                                    <svg class="w-5 h-5 transform transition-transform duration-200" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>
                                <div class="hidden px-4 pb-4 stores-list">
                                    <!-- Will be populated with store details -->
                                </div>
                            </div>

                            <!-- Coverage Details -->
                            <div class="border rounded-lg">
                                <button class="flex justify-between items-center w-full px-4 py-3 text-left">
                                    <span class="font-medium">Coverage Details</span>
                                    <svg class="w-5 h-5 transform transition-transform duration-200" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>
                                <div class="hidden px-4 pb-4 coverage-details">
                                    <!-- Will be populated with coverage details -->
                                </div>
                            </div>

                            <!-- Special Features -->
                            <div class="border rounded-lg">
                                <button class="flex justify-between items-center w-full px-4 py-3 text-left">
                                    <span class="font-medium">Special Features</span>
                                    <svg class="w-5 h-5 transform transition-transform duration-200" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>
                                <div class="hidden px-4 pb-4 special-features">
                                    <!-- Will be populated with features -->
                                </div>
                            </div>
                        </div>

                        <!-- Action Button -->
                        <button
                            class="w-full mt-6 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors">
                            Get This Plan
                        </button>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <script src="telco-data.js"></script>


    <script>
        // State management
        let currentStep = 1;
        const formData = {
            userType: '',
            stayDuration: '',
            budget: '',
            planType: '',
            dataNeeds: '',
            location: '',
            features: [],
            needs: {
                coverage: false,
                international: false,
                entertainment: false,
                speed: false
            }
        };

        // Add this after your formData initialization
        document.addEventListener('DOMContentLoaded', function () {
            // Set initial values for the usage calculator
            calculateUsage();

            // Set default plan type to "any"
            const anyPlanRadio = document.querySelector('input[name="planType"][value="any"]');
            if (anyPlanRadio) {
                anyPlanRadio.checked = true;
                formData.planType = 'any';
            }

            // Validate initial state
            validateStep1();
            validateStep2();
            validateStep3();
        });

        // DOM Elements
        const userTypeBtns = document.querySelectorAll('.user-type-btn');
        const stayDuration = document.getElementById('stayDuration');
        const nextStep1 = document.getElementById('nextStep1');
        const nextStep2 = document.getElementById('nextStep2');
        const nextStep3 = document.getElementById('nextStep3');

        // Step 1 Validation
        function validateStep1() {
            const isValid = formData.userType && formData.stayDuration;
            nextStep1.disabled = !isValid;
        }

        // User Type Selection
        userTypeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active state from all buttons
                userTypeBtns.forEach(b => b.classList.remove('border-blue-500'));
                // Add active state to clicked button
                btn.classList.add('border-blue-500');
                formData.userType = btn.dataset.type;
                validateStep1();
            });
        });

        // Stay Duration Selection
        stayDuration.addEventListener('change', (e) => {
            formData.stayDuration = e.target.value;
            validateStep1();
        });

        // Step 2 Validation
        // Step 2 Validation
        function validateStep2() {
            const isValid = formData.budget && formData.planType && formData.dataNeeds;
            nextStep2.disabled = !isValid;
        }

        // Budget Input
        document.getElementById('budget').addEventListener('input', (e) => {
            formData.budget = e.target.value;
            validateStep2();
        });

        // Plan Type Selection
        document.querySelectorAll('input[name="planType"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                formData.planType = e.target.value;
                validateStep2();
            });
        });

        // Data Needs Selection
        document.getElementById('dataNeeds').addEventListener('change', (e) => {
            formData.dataNeeds = e.target.value;
            validateStep2();
        });


        // Location Selection
        document.getElementById('location').addEventListener('change', (e) => {
            formData.location = e.target.value;
            validateStep3();
        });

        // Feature Selection
        // After feature selection in your wizard.php
        document.querySelectorAll('input[name="features"]').forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                if (!formData.needs) {
                    formData.needs = {};
                }
                formData.needs[e.target.value] = e.target.checked;
                console.log('Updated formData:', formData); // Debug log
            });
        });

        // Navigation Functions
        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
            // Show current step
            document.getElementById(`step${step}`).classList.remove('hidden');

            // Update progress circles
            document.querySelectorAll('.step-circle').forEach((circle, index) => {
                if (index + 1 < step) {
                    circle.classList.add('bg-blue-600', 'text-white');
                } else if (index + 1 === step) {
                    circle.classList.add('bg-blue-600', 'text-white');
                } else {
                    circle.classList.remove('bg-blue-600', 'text-white');
                }
            });

            // Update progress bars
            document.querySelectorAll('.progress-bar').forEach((bar, index) => {
                if (index + 1 < step) {
                    bar.style.width = '100%';
                    bar.classList.add('bg-blue-600');
                } else {
                    bar.style.width = '0%';
                    bar.classList.remove('bg-blue-600');
                }
            });
        }

        function nextStep() {
            if (currentStep < 4) {
                currentStep++;
                showStep(currentStep);
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        // Add click handlers for next buttons
        nextStep1.addEventListener('click', nextStep);
        nextStep2.addEventListener('click', nextStep);
        nextStep3.addEventListener('click', showResults);



        // Add this at the end of your showResults function in the HTML file
        // Replace your existing showResults function with this one
        function showResults() {
            currentStep = 4;
            showStep(4);

            // Log the form data to verify it's correct
            console.log('Submitting form data:', formData);

            // Get the results container and clear previous results
            const resultsContainer = document.getElementById('recommendationsList');
            const loadingState = document.getElementById('loadingState');

            try {
                // Verify that the necessary functions are available
                if (typeof window.getDetailedRecommendations !== 'function') {
                    throw new Error('Recommendation engine not properly loaded');
                }

                // Make sure all required data is present
                if (!formData.userType || !formData.location || !formData.dataNeeds) {
                    throw new Error('Missing required form data');
                }

                // Get recommendations
                const recommendations = window.getDetailedRecommendations(formData);
                console.log('Raw recommendations:', recommendations);

                if (!recommendations || recommendations.length === 0) {
                    resultsContainer.innerHTML = `
                <div class="text-center py-8">
                    <p class="text-gray-600">No matching plans found. Please try adjusting your criteria.</p>
                </div>
            `;
                    return;
                }

                // Display recommendations
                displayRecommendations(recommendations);

            } catch (error) {
                console.error('Error getting recommendations:', error);
                resultsContainer.innerHTML = `
            <div class="text-center py-8">
                <p class="text-red-600">There was an error finding plans. Please try again.</p>
                <p class="text-sm text-gray-600 mt-2">${error.message}</p>
            </div>
        `;
            } finally {
                // Remove loading state
                if (loadingState) {
                    loadingState.remove();
                }
            }
        }

        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendationsList');
            const template = document.getElementById('recommendationTemplate');
            const loadingState = document.getElementById('loadingState');

            // Remove loading state
            if (loadingState) loadingState.remove();
            container.innerHTML = '';


            recommendations.forEach((recommendation, index) => {
                const card = template.content.cloneNode(true);

                // Set provider name and details
                card.querySelector('h3').textContent = recommendation.name;

                // Set recommendation tag
                const tagElem = card.querySelector('.recommendation-tag');
                tagElem.textContent = index === 0 ? "Best Match" :
                    index === 1 ? "Great Value" :
                        "Good Option";

                // Set network name
                const networkName = card.querySelector('.network-name');
                networkName.textContent = recommendation.type === 'major' ?
                    `${recommendation.name} Network` :
                    `${recommendation.network?.toUpperCase() || 'Standard'} network`;

                // Set coverage quality
                // Set coverage quality
                const coverageQuality = card.querySelector('.coverage-quality');
                const coverage = recommendation?.coverage?.sydney?.[formData.location]?.general || 'Standard';
                coverageQuality.textContent = coverage;

                // Find the best plan for this user
                const bestPlan = window.findBestMatchingPlan(recommendation, formData) ||
                    window.findCheapestPlan(recommendation);

                // Set price
                const priceElem = card.querySelector('.price');
                priceElem.textContent = bestPlan ? `$${bestPlan.price}/mo` : 'Varies';

                // Set data amount
                const dataElem = card.querySelector('.data-amount');
                dataElem.textContent = bestPlan ? bestPlan.data : 'Varies';

                // Populate stores list
                const storesList = card.querySelector('.stores-list');
                populateStoresList(storesList, recommendation.store_locations?.[formData.location] || []);

                // Populate coverage details
                const coverageDetails = card.querySelector('.coverage-details');
                populateCoverageDetails(coverageDetails, recommendation, formData.location);

                // Populate special features
                const specialFeatures = card.querySelector('.special-features');
                populateSpecialFeatures(specialFeatures, recommendation);

                // Add click handlers for expandable sections
                // card.querySelectorAll('button').forEach(button => {
                //     if (!button.classList.contains('w-full')) { // Skip the main action button
                //         button.addEventListener('click', function () {
                //             const content = this.nextElementSibling;
                //             const arrow = this.querySelector('svg');
                //             content.classList.toggle('hidden');
                //             arrow.classList.toggle('rotate-180');
                //         });
                //     }
                // });

                const expandButtons = card.querySelectorAll('.border.rounded-lg > button');
                expandButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        // Find the content div that follows this button
                        const content = this.nextElementSibling;
                        const arrow = this.querySelector('svg');

                        // Toggle visibility
                        if (content.classList.contains('hidden')) {
                            // If it's hidden, show it and update content if needed
                            content.classList.remove('hidden');
                            arrow.classList.add('rotate-180');

                            // Determine which section this is and populate content
                            if (content.classList.contains('stores-list')) {
                                populateStoresList(content, recommendation.store_locations?.[formData.location] || []);
                            } else if (content.classList.contains('coverage-details')) {
                                populateCoverageDetails(content, recommendation, formData.location);
                            } else if (content.classList.contains('special-features')) {
                                populateSpecialFeatures(content, recommendation);
                            }
                        } else {
                            // If it's shown, hide it
                            content.classList.add('hidden');
                            arrow.classList.remove('rotate-180');
                        }
                    });
                });


                container.appendChild(card);
            });
        }
        // Helper function to find cheapest plan
        function findCheapestPlan(provider) {
            const allPlans = [
                ...(provider.plans?.prepaid || []),
                ...(provider.plans?.postpaid || [])
            ];

            return allPlans.reduce((cheapest, plan) => {
                if (!cheapest || plan.price < cheapest.price) {
                    return plan;
                }
                return cheapest;
            }, null);
        }

        // Helper functions
        function getNetworkName(provider) {
            if (provider.type === 'major') return `${provider.name} Network`;
            return `${provider.name} (${provider.network.toUpperCase()} network)`;
        }

        function findCheapestPlan(provider) {
            const plans = provider.plans?.prepaid || provider.plans?.postpaid || [];
            return plans.reduce((cheapest, plan) =>
                (!cheapest || plan.price < cheapest.price) ? plan : cheapest, null);
        }

        function getBestDataPlan(provider) {
            const plans = provider.plans?.prepaid || provider.plans?.postpaid || [];
            const bestPlan = plans.reduce((best, plan) =>
                (!best || parseInt(plan.data) > parseInt(best.data)) ? plan : best, null);
            return bestPlan?.data || 'N/A';
        }

        function populateStoresList(container, stores) {
            if (!stores?.length) {
                container.innerHTML = `
        <p class="text-gray-600 text-sm">No physical stores nearby. Visit website to purchase.</p>
    `;
                return;
            }

            container.innerHTML = stores.map(store => `
        <div class="mb-4 last:mb-0">
            <h4 class="font-medium text-gray-900">${store.name}</h4>
            <p class="text-sm text-gray-600">${store.address}</p>
            <p class="text-sm text-gray-600">${store.hours}</p>
            <div class="mt-2 flex items-center space-x-4">
                <a href="tel:${store.phone}" class="text-blue-600 text-sm hover:underline">
                    ${store.phone}
                </a>
                <a href="${store.google_maps}" target="_blank" class="text-blue-600 text-sm hover:underline">
                    View on Maps
                </a>
            </div>
            <p class="text-sm text-gray-500 mt-1">
                <span class="text-blue-600">üìç</span> ${store.nearest_transport}
            </p>
        </div>
    `).join('');
        }

        function populateCoverageDetails(container, provider, location) {
            try {
                const coverage = provider?.coverage?.sydney || {};
                const peakPerformance = coverage?.peak_performance?.[location];
                const deadZones = coverage?.dead_zones || [];

                container.innerHTML = `
        <div class="space-y-4">
            ${peakPerformance ? `
                <div class="bg-yellow-50 p-3 rounded-lg">
                    <h4 class="font-medium text-yellow-800">Peak Hours</h4>
                    <p class="text-sm text-yellow-700">${peakPerformance.peak_times}</p>
                    <p class="text-sm text-yellow-600 mt-1">${peakPerformance.impact}</p>
                </div>
            ` : ''}
            
            ${deadZones.length > 0 ? `
                <div class="bg-red-50 p-3 rounded-lg">
                    <h4 class="font-medium text-red-800">Known Coverage Gaps</h4>
                    ${deadZones.map(zone => `
                        <div class="mt-2">
                            <p class="text-sm text-red-700">${zone.location}</p>
                            <p class="text-sm text-red-600">${zone.description}</p>
                        </div>
                    `).join('')}
                </div>
            ` : ''}
            
            ${provider.complementary_wifi ? `
                <div class="bg-green-50 p-3 rounded-lg">
                    <h4 class="font-medium text-green-800">Free WiFi Access</h4>
                    <p class="text-sm text-green-700">${provider.complementary_wifi.access || 'Available'}</p>
                    <p class="text-sm text-green-600 mt-1">Available at: ${provider.complementary_wifi.locations?.[location]?.join(', ') || 'Selected locations'}</p>
                </div>
            ` : ''}
            
            ${!peakPerformance && !deadZones.length && !provider.complementary_wifi ? `
                <p class="text-gray-600 text-sm">Standard coverage available in this area</p>
            ` : ''}
        </div>
    `;
            } catch (error) {
                console.error('Error displaying coverage details:', error);
                container.innerHTML = `
            <p class="text-gray-600 text-sm">Coverage information not available</p>
        `;
            }
        }
        function populateSpecialFeatures(container, provider) {
            try {
                const features = [];

                if (provider?.partnerships?.length) {
                    features.push(`
                <div class="mb-3">
                    <h4 class="font-medium text-gray-900">Special Deals</h4>
                    ${provider.partnerships.map(partnership => `
                        <div class="mt-2">
                            <p class="text-sm text-gray-700">${partnership.partner}: ${partnership.benefit}</p>
                            ${partnership.how_to_activate ?
                            `<p class="text-sm text-gray-600">How to get: ${partnership.how_to_activate}</p>`
                            : ''}
                        </div>
                    `).join('')}
                </div>
            `);
                }

                if (provider?.support) {
                    features.push(`
                <div class="mb-3">
                    <h4 class="font-medium text-gray-900">Tourist Support</h4>
                    <p class="text-sm text-gray-700">Hotline: ${provider.support.tourist_hotline || 'Available'}</p>
                    <p class="text-sm text-gray-600">Hours: ${provider.support.tourist_support_hours || 'Business hours'}</p>
                    <p class="text-sm text-gray-600">Languages: ${provider.support.languages?.join(', ') || 'English'}</p>
                </div>
            `);
                }

                container.innerHTML = features.join('') ||
                    '<p class="text-gray-600 text-sm">Standard features available</p>';
            } catch (error) {
                console.error('Error displaying features:', error);
                container.innerHTML = '<p class="text-gray-600 text-sm">Feature information not available</p>';
            }
        }

        // Mock function to generate recommendations
        function getMockRecommendations() {
            console.log('Form Data:', formData); // Debug log

            try {
                // Use the real data and recommendation engine
                const recommendations = window.getRecommendations(formData);
                console.log('Raw Recommendations:', recommendations); // Debug log

                return recommendations.map(provider => {
                    try {
                        // Determine plan type
                        const planType = formData.planType === 'any' ?
                            (provider.plans.postpaid ? 'postpaid' : 'prepaid') :
                            formData.planType;

                        // Get the plans for the selected type
                        const plans = provider.plans[planType];
                        if (!plans || plans.length === 0) {
                            console.log('No plans found for', provider.name);
                            return null;
                        }

                        // Get the first plan of the selected type
                        const selectedPlan = plans[0];

                        return {
                            ...provider, // Keep all provider properties
                            selectedPlan: selectedPlan, // Add the selected plan
                            recommendation: provider.score > 5 ? "Best Match" :
                                provider.score > 3 ? "Great Value" : "Good Option"
                        };
                    } catch (error) {
                        console.error('Error processing provider:', provider, error);
                        return null;
                    }
                }).filter(Boolean) // Remove null entries
                    .slice(0, 5); // Show top 5 recommendations
            } catch (error) {
                console.error('Error getting recommendations:', error);
                return []; // Return empty array if there's an error
            }
        }
        // Add this helper function near the top of your script section
        function getInsightBackgroundColor(type) {
            switch (type) {
                case 'warning':
                    return 'bg-amber-50';
                case 'benefit':
                    return 'bg-green-50';
                case 'tip':
                    return 'bg-blue-50';
                default:
                    return 'bg-gray-50';
            }
        }


        // Add some CSS for the progress indicators
        const style = document.createElement('style');
        style.textContent = `
            .step-circle {
                width: 2rem;
                height: 2rem;
                border-radius: 50%;
                background: white;
                border: 2px solid #e5e7eb;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
            }
            .progress-bar {
                height: 100%;
                transition: width 0.3s ease-in-out;
            }
        `;
        document.head.appendChild(style);
    </script>

    <script>
        // Usage rates in GB per hour
        const usageRates = {
            navigation: 0.1,
            video: 0.7,
            social: 0.15
        };

        // Calculate total usage and update form data
        // Replace your existing calculateUsage function with this one
        function calculateUsage() {
            const duration = parseInt(document.getElementById('tripDuration').value) || 0;
            const navigation = (parseFloat(document.getElementById('navigationHours').value) || 0) * usageRates.navigation;
            const video = (parseFloat(document.getElementById('videoHours').value) || 0) * usageRates.video;
            const social = (parseFloat(document.getElementById('socialHours').value) || 0) * usageRates.social;

            const dailyUsage = navigation + video + social;
            const monthlyUsage = (dailyUsage * 30).toFixed(1); // Estimate monthly usage

            // Update the display
            const usageResult = document.getElementById('usageResult');
            usageResult.querySelector('p').textContent = `${monthlyUsage} GB`;

            // Set the dataNeeds value based on calculated usage
            let dataNeeds = '';
            if (monthlyUsage > 100) {
                dataNeeds = 'unlimited';
            } else if (monthlyUsage > 30) {
                dataNeeds = 'heavy';
            } else if (monthlyUsage > 0) {
                dataNeeds = 'light';
            } else {
                dataNeeds = 'light'; // Default to light if no usage entered
            }

            // Update both the hidden input and the formData object
            const dataNeedsInput = document.getElementById('dataNeeds');
            dataNeedsInput.value = dataNeeds;
            formData.dataNeeds = dataNeeds;

            console.log('Updated dataNeeds:', dataNeeds);
            console.log('Current formData:', formData);

            validateStep2();
        }

        // Replace your validateStep2 function
        function validateStep2() {
            // Set default plan type to "any" if none selected
            if (!formData.planType) {
                const anyPlanRadio = document.querySelector('input[name="planType"][value="any"]');
                if (anyPlanRadio) {
                    anyPlanRadio.checked = true;
                    formData.planType = 'any';
                }
            }

            const isValid = formData.budget &&
                formData.planType &&
                formData.dataNeeds &&
                parseInt(formData.budget) > 0;

            console.log('Step 2 Validation:', {
                budget: formData.budget,
                planType: formData.planType,
                dataNeeds: formData.dataNeeds,
                isValid: isValid
            });

            nextStep2.disabled = !isValid;
            return isValid;
        }

        // Replace your validateStep3 function
        function validateStep3() {
            const isValid = formData.location;
            nextStep3.disabled = !isValid;
            console.log('Step 3 Validation:', {
                location: formData.location,
                isValid: isValid
            });
            return isValid;
        }

        // Add event listeners
        ['tripDuration', 'navigationHours', 'videoHours', 'socialHours'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateUsage);
        });


    </script>



    <script>
        // Area descriptions for tourists
        const areaDetails = {
            cbd: {
                description: "The bustling heart of Sydney, featuring skyscrapers, shopping districts, and major tourist attractions. This area has excellent coverage and is well-connected by public transport.",
                spots: "Notable spots: Sydney Opera House, Harbour Bridge, The Rocks, Circular Quay, Pitt Street Mall"
            },
            inner: {
                description: "A vibrant area surrounding the city centre, known for its cafe culture, boutique shopping, and nightlife. These trendy neighborhoods are popular with young professionals and tourists.",
                spots: "Notable spots: Surry Hills cafes, Newtown's King Street, Glebe Markets, Chippendale's galleries"
            },
            eastern: {
                description: "Home to Sydney's famous beaches and coastal walks. This area combines beachside lifestyle with upscale neighborhoods and tourist attractions.",
                spots: "Notable spots: Bondi Beach, Coastal Walk, Coogee Beach, Centennial Park, Westfield Bondi Junction"
            },
            western: {
                description: "The greater western region of Sydney, including major business districts and shopping areas. This diverse area is more residential but includes key attractions.",
                spots: "Notable spots: Parramatta CBD, Olympic Park, Rosehill Gardens, Westfield Parramatta"
            },
            northern: {
                description: "Beautiful beaches, leafy suburbs, and shopping districts north of the harbour. Popular for its beach lifestyle and family-friendly areas.",
                spots: "Notable spots: Manly Beach, Taronga Zoo, Chatswood Shopping, North Sydney"
            },
            southern: {
                description: "Stretching from the airport to the southern beaches, this area includes both residential suburbs and tourist spots. Convenient for airport access.",
                spots: "Notable spots: Sydney Airport, Cronulla Beach, Brighton-Le-Sands, The Royal National Park"
            }
        };

        // Update area description when location is selected
        document.getElementById('location').addEventListener('change', function (e) {
            const location = e.target.value;
            const descriptionPanel = document.getElementById('areaDescription');

            if (location && areaDetails[location]) {
                // Show and update description
                descriptionPanel.classList.remove('hidden');
                document.getElementById('areaDetail').textContent = areaDetails[location].description;
                document.getElementById('areaTouristSpots').textContent = areaDetails[location].spots;
            } else {
                descriptionPanel.classList.add('hidden');
            }
        });
    </script>
</body>

</html>